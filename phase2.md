# فاز ۲ – پیاده‌سازی nftables

## معرفی

در فاز دوم پروژه، nftables به‌عنوان مکانیزم اصلی Firewall و NAT
روی سیستم‌عامل Debian 12 پیاده‌سازی شده است.
در این فاز، کاربر می‌تواند قوانین شبکه را ایجاد، حذف و مدیریت کند
و اثر اعمال قوانین را به‌صورت واقعی روی ترافیک شبکه مشاهده نماید.

رابط کاربری به‌صورت TUI برای انتخاب منوها
و CLI برای دریافت ورودی‌های فنی طراحی شده است.

---

## قابلیت‌های پیاده‌سازی‌شده

### Firewall
- قوانین مبتنی بر وضعیت اتصال (state-based)
- قوانین مبتنی بر پورت (TCP / UDP)
- قوانین ICMP
- افزودن قوانین به‌صورت Temporary و Permanent
- حذف قوانین Temporary و Permanent

---

### NAT

#### DNAT (Port Forwarding)
- هدایت پورت بر اساس interface، پروتکل و پورت
- افزودن DNAT به‌صورت Temporary و Permanent
- حذف DNAT به‌صورت Temporary و Permanent

#### MASQUERADE
- افزودن MASQUERADE فقط به‌صورت Permanent
- حذف MASQUERADE به‌صورت Permanent

---

## حذف قوانین با استفاده از Handle

در nftables هر قانون دارای یک شناسه داخلی به نام **handle** است.
برای حذف قوانین، از همین مکانیزم استاندارد استفاده شده است.

روند حذف قانون:
1. کاربر گزینه حذف قانون را از منو انتخاب می‌کند.
2. لیست قوانین مربوطه به‌همراه شماره **handle** در ترمینال نمایش داده می‌شود.
3. کاربر باید عدد **handle** مربوط به قانون مورد نظر را شناسایی کند.
4. عدد handle در ترمینال وارد می‌شود.
5. در صورت معتبر بودن handle، قانون حذف می‌شود.
6. در صورت نامعتبر بودن handle، عملیات حذف انجام نمی‌شود و خطا نمایش داده می‌شود.

---

## نمایش قوانین (Show Rules)

در بخش **Show rules**، قوانین فعلی nftables به‌صورت کامل و اسکرول‌پذیر نمایش داده می‌شوند.

### خروج از صفحه نمایش قوانین
برای بازگشت به منوی قبلی:
- **باید کلید `ESC` را فشار دهید**

این رفتار بخشی از طراحی برنامه است.

---

## ماندگاری قوانین

قوانین Permanent در فایل زیر ذخیره می‌شوند:

/etc/nftables.conf


پس از راه‌اندازی مجدد سیستم، این قوانین به‌صورت خودکار بازیابی می‌شوند.

---

## جمع‌بندی

در فاز دوم پروژه، nftables به‌صورت عملیاتی پیاده‌سازی شده
و امکان مدیریت قوانین Firewall و NAT فراهم شده است.

